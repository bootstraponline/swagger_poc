// Generated by CoffeeScript 1.12.2
var expandUriTemplateWithParameters, ut;

ut = require('uri-template');

expandUriTemplateWithParameters = function(uriTemplate, parameters) {
  var ambiguous, e, expression, i, j, k, l, len, len1, len2, len3, param, parsed, ref, ref1, result, toExpand, uriParameter, uriParameters;
  result = {
    errors: [],
    warnings: [],
    uri: null
  };
  try {
    parsed = ut.parse(uriTemplate);
  } catch (error) {
    e = error;
    result.errors.push("Failed to parse URI template: " + uriTemplate + "\nError: " + e);
    return result;
  }
  uriParameters = [];
  ref = parsed.expressions;
  for (i = 0, len = ref.length; i < len; i++) {
    expression = ref[i];
    ref1 = expression.params;
    for (j = 0, len1 = ref1.length; j < len1; j++) {
      param = ref1[j];
      uriParameters.push(param.name);
    }
  }
  if (parsed.expressions.length === 0) {
    result.uri = uriTemplate;
  } else {
    ambiguous = false;
    for (k = 0, len2 = uriParameters.length; k < len2; k++) {
      uriParameter = uriParameters[k];
      if (Object.keys(parameters).indexOf(uriParameter) === -1) {
        ambiguous = true;
        result.warnings.push("Ambiguous URI parameter in template: " + uriTemplate + "\nParameter not defined in API description document: " + uriParameter);
      }
    }
    if (!ambiguous) {
      toExpand = {};
      for (l = 0, len3 = uriParameters.length; l < len3; l++) {
        uriParameter = uriParameters[l];
        param = parameters[uriParameter];
        if (param.example) {
          toExpand[uriParameter] = param.example;
        } else if (param["default"]) {
          toExpand[uriParameter] = param["default"];
        } else {
          if (param.required) {
            ambiguous = true;
            result.warnings.push("Ambiguous URI parameter in template: " + uriTemplate + "\nNo example value for required parameter in API description document: " + uriParameter);
          }
        }
        if (param.required && param["default"]) {
          result.warnings.push("Required URI parameter '" + uriParameter + "' has a default value.\nDefault value for a required parameter doesn't make sense from API description perspective. Use example value instead.");
        }
      }
    }
    if (!ambiguous) {
      result.uri = parsed.expand(toExpand);
    }
  }
  return result;
};

module.exports = expandUriTemplateWithParameters;
